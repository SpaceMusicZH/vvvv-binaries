/**************************
***** Compiler Parameters *****
***************************
@P EffectName: ComputeFXEffect
@P   - ComputeEffectShader.ThreadNumbers: X:1 Y:1 Z:1
@P EffectNodeBase.EffectNodeBaseShader: mixin FinalizeBuffer_ComputeFX
***************************
****  ConstantBuffers  ****
***************************
cbuffer Globals [Size: 48]
@C    gridSize_id12 => SdfUtils.gridSize
@C    gridCenter_id13 => SdfUtils.gridCenter
@C    cellCount_id14 => SdfUtils.cellCount
@C    cellSize_id15 => SdfUtils.cellSize
***************************
******  Resources    ******
***************************
@R    SDFBuffer_id11 => SdfUtils.SDFBuffer [Stage: Compute, Slot: (0-0)]
@R    SDFTexture_id16 => FinalizeBuffer_ComputeFX.SDFTexture [Stage: Compute, Slot: (1-1)]
@R    Globals => Globals [Stage: Compute, Slot: (0-0)]
***************************
*****     Sources     *****
***************************
@S    ComputeShaderBase => 8f045851eaa4513eb38a704d53889e6d
@S    FinalizeBuffer_ComputeFX => 4ff93c3b3bd132dc95ad45264d7b9a9b
@S    SdfUtils => 0c43dc469c93d94288b74a43e650ed91
***************************
*****     Stages      *****
***************************
@G    Compute => a01c5454be2b6dcca1f88f984eeb2017
//
// Generated by Microsoft (R) HLSL Shader Compiler 10.1
//
//
// Buffer Definitions: 
//
// cbuffer Globals
// {
//
//   float3 gridSize_id12;              // Offset:    0 Size:    12 [unused]
//   float3 gridCenter_id13;            // Offset:   16 Size:    12 [unused]
//   float3 cellCount_id14;             // Offset:   32 Size:    12
//   float cellSize_id15;               // Offset:   44 Size:     4 [unused]
//
// }
//
// Resource bind info for SDFBuffer_id11
// {
//
//   uint $Element;                     // Offset:    0 Size:     4
//
// }
//
//
// Resource Bindings:
//
// Name                                 Type  Format         Dim      HLSL Bind  Count
// ------------------------------ ---------- ------- ----------- -------------- ------
// SDFBuffer_id11                        UAV  struct         r/w             u0      1 
// SDFTexture_id16                       UAV   float          3d             u1      1 
// Globals                           cbuffer      NA          NA            cb0      1 
//
//
//
// Input signature:
//
// Name                 Index   Mask Register SysValue  Format   Used
// -------------------- ----- ------ -------- -------- ------- ------
// no Input
//
// Output signature:
//
// Name                 Index   Mask Register SysValue  Format   Used
// -------------------- ----- ------ -------- -------- ------- ------
// no Output
cs_5_0
dcl_globalFlags refactoringAllowed
dcl_constantbuffer CB0[3], immediateIndexed
dcl_uav_structured u0, 4
dcl_uav_typed_texture3d (float,float,float,float) u1
dcl_input vThreadID.xyz
dcl_temps 1
dcl_thread_group 1, 1, 1
//
// Initial variable locations:
//   vThreadGroupID.x <- __input__.GroupId_id0.x; vThreadGroupID.y <- __input__.GroupId_id0.y; vThreadGroupID.z <- __input__.GroupId_id0.z; 
//   vThreadID.x <- __input__.DispatchThreadId_id1.x; vThreadID.y <- __input__.DispatchThreadId_id1.y; vThreadID.z <- __input__.DispatchThreadId_id1.z
//
#line 43 "H:\JHH_SpaceMusic\SpaceMusicZH\vvvv-binaries\vvvv_gamma\log\shader_ComputeFXEffect_d4aa98cf317c8376a5233c2f7e3ffb0c.hlsl"
ftou r0.xyz, cb0[2].xyzx
uge r0.xyz, vThreadID.xyzx, r0.xyzx
or r0.x, r0.y, r0.x
or r0.x, r0.z, r0.x

#line 45
if_z r0.x

#line 36
  ftoi r0.x, cb0[2].x  // r0.x <- cellsPerLine

#line 37
  mul r0.y, cb0[2].y, cb0[2].x
  ftoi r0.y, r0.y  // r0.y <- cellsPerPlane

#line 38
  imul null, r0.x, r0.x, vThreadID.y
  imad r0.x, r0.y, vThreadID.z, r0.x
  iadd r0.x, r0.x, vThreadID.x  // r0.x <- <GetSdfCellIndex_id8 return value>

#line 45
  ld_structured_indexable(structured_buffer, stride=4)(mixed,mixed,mixed,mixed) r0.x, r0.x, l(0), u0.xxxx  // r0.x <- dist

#line 32
  ushr r0.y, r0.x, l(1)
  bfi r0.x, l(1), l(31), r0.x, r0.y  // r0.x <- <IFloatFlip3_id5 return value>

#line 46
  store_uav_typed u1.xyzw, vThreadID.xyzz, r0.xxxx
endif 

#line 61
ret 
// Approximately 17 instruction slots used
***************************
*************************/
struct CS_STREAMS 
{
    uint3 GroupId_id0;
    uint3 DispatchThreadId_id1;
    int ThreadCountX_id7;
    int ThreadCountY_id8;
    int ThreadCountZ_id9;
    uint ThreadCountPerGroup_id5;
    uint3 ThreadGroupCount_id4;
    uint ThreadGroupIndex_id6;
};
struct CS_INPUT 
{
    uint3 GroupId_id0 : SV_GroupID;
    uint3 DispatchThreadId_id1 : SV_DispatchThreadID;
};
cbuffer PerDispatch 
{
    int3 ThreadGroupCountGlobal_id10;
};
cbuffer Globals 
{
    float3 gridSize_id12;
    float3 gridCenter_id13;
    float3 cellCount_id14;
    float cellSize_id15;
};
RWStructuredBuffer<uint> SDFBuffer_id11;
RWTexture3D<float> SDFTexture_id16;
uint IFloatFlip3_id5(uint f2)
{
    return (f2 >> 1) | (f2 << 31);
}
int GetSdfCellIndex_id8(int3 gridPosition)
{
    int cellsPerLine = cellCount_id14.x;
    int cellsPerPlane = cellCount_id14.x * cellCount_id14.y;
    return cellsPerPlane * gridPosition.z + cellsPerLine * gridPosition.y + gridPosition.x;
}
void Compute_id14(inout CS_STREAMS streams)
{
    uint3 cellIndex = streams.DispatchThreadId_id1.xyz;
    if (cellIndex.x >= (uint)cellCount_id14.x || cellIndex.y >= (uint)cellCount_id14.y || cellIndex.z >= (uint)cellCount_id14.z)
        return;
    uint dist = SDFBuffer_id11[GetSdfCellIndex_id8(cellIndex)];
    SDFTexture_id16[cellIndex] = asfloat(IFloatFlip3_id5(dist));
}
[numthreads(1, 1, 1)]
void CSMain(CS_INPUT __input__)
{
    CS_STREAMS streams = (CS_STREAMS)0;
    streams.GroupId_id0 = __input__.GroupId_id0;
    streams.DispatchThreadId_id1 = __input__.DispatchThreadId_id1;
    streams.ThreadCountX_id7 = 1;
    streams.ThreadCountY_id8 = 1;
    streams.ThreadCountZ_id9 = 1;
    streams.ThreadCountPerGroup_id5 = 1 * 1 * 1;
    streams.ThreadGroupCount_id4 = ThreadGroupCountGlobal_id10;
    streams.ThreadGroupIndex_id6 = (streams.GroupId_id0.z * streams.ThreadGroupCount_id4.y + streams.GroupId_id0.y) * streams.ThreadGroupCount_id4.x + streams.GroupId_id0.x;
    Compute_id14(streams);
}
